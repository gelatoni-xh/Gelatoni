<configuration scan="true">

    <!-- ================= 基础属性 ================= -->

    <property name="LOG_PATTERN"
              value="%d{yyyy-MM-dd HH:mm:ss.SSS} %-5level [%thread] %logger{36} - %msg%n"/>

    <property name="LOG_HOME" value="${LOG_HOME:-./logs}"/>

    <!-- ================= Appenders ================= -->

    <!-- 控制台 -->
    <appender name="CONSOLE" class="ch.qos.logback.core.ConsoleAppender">
        <encoder>
            <pattern>${LOG_PATTERN}</pattern>
        </encoder>
    </appender>

    <!-- 应用主日志 -->
    <appender name="APP_FILE" class="ch.qos.logback.core.rolling.RollingFileAppender">
        <file>${LOG_HOME}/app.log</file>
        <rollingPolicy class="ch.qos.logback.core.rolling.SizeAndTimeBasedRollingPolicy">
            <fileNamePattern>${LOG_HOME}/app-%d{yyyy-MM-dd}.%i.log</fileNamePattern>
            <maxFileSize>50MB</maxFileSize>
            <maxHistory>30</maxHistory>
            <totalSizeCap>2GB</totalSizeCap>
        </rollingPolicy>
        <encoder>
            <pattern>${LOG_PATTERN}</pattern>
        </encoder>
    </appender>

    <!-- 应用 ERROR 日志 -->
    <appender name="APP_ERROR_FILE" class="ch.qos.logback.core.rolling.RollingFileAppender">
        <file>${LOG_HOME}/error.log</file>
        <rollingPolicy class="ch.qos.logback.core.rolling.SizeAndTimeBasedRollingPolicy">
            <fileNamePattern>${LOG_HOME}/error-%d{yyyy-MM-dd}.%i.log</fileNamePattern>
            <maxFileSize>50MB</maxFileSize>
            <maxHistory>30</maxHistory>
            <totalSizeCap>1GB</totalSizeCap>
        </rollingPolicy>

        <filter class="ch.qos.logback.classic.filter.LevelFilter">
            <level>ERROR</level>
            <onMatch>ACCEPT</onMatch>
            <onMismatch>DENY</onMismatch>
        </filter>

        <encoder>
            <pattern>${LOG_PATTERN}</pattern>
        </encoder>
    </appender>

    <!-- ================= Controller Digest ================= -->

    <appender name="CONTROLLER_DIGEST"
              class="ch.qos.logback.core.rolling.RollingFileAppender">
        <file>${LOG_HOME}/digest/controller/digest.log</file>
        <rollingPolicy class="ch.qos.logback.core.rolling.TimeBasedRollingPolicy">
            <fileNamePattern>
                ${LOG_HOME}/digest/controller/digest.%d{yyyy-MM-dd}.log
            </fileNamePattern>
            <maxHistory>30</maxHistory>
        </rollingPolicy>
        <encoder>
            <pattern>
                %d{yyyy-MM-dd HH:mm:ss.SSS} %-5level [%thread] %msg%n
            </pattern>
        </encoder>
    </appender>

    <!-- ================= Redis Digest ================= -->

    <appender name="REDIS_DIGEST"
              class="ch.qos.logback.core.rolling.RollingFileAppender">
        <file>${LOG_HOME}/digest/redis/digest.log</file>
        <rollingPolicy class="ch.qos.logback.core.rolling.TimeBasedRollingPolicy">
            <fileNamePattern>
                ${LOG_HOME}/digest/redis/digest.%d{yyyy-MM-dd}.log
            </fileNamePattern>
            <maxHistory>30</maxHistory>
        </rollingPolicy>
        <encoder>
            <pattern>
                %d{yyyy-MM-dd HH:mm:ss.SSS} %-5level [%thread] %msg%n
            </pattern>
        </encoder>
    </appender>

    <!-- ================= Mapper Digest ================= -->

    <appender name="MAPPER_DIGEST"
              class="ch.qos.logback.core.rolling.RollingFileAppender">
        <file>${LOG_HOME}/digest/mapper/digest.log</file>
        <rollingPolicy class="ch.qos.logback.core.rolling.TimeBasedRollingPolicy">
            <fileNamePattern>
                ${LOG_HOME}/digest/mapper/digest.%d{yyyy-MM-dd}.log
            </fileNamePattern>
            <maxHistory>30</maxHistory>
        </rollingPolicy>
        <encoder>
            <pattern>
                %d{yyyy-MM-dd HH:mm:ss.SSS} %-5level [%thread] %msg%n
            </pattern>
        </encoder>
    </appender>

    <!-- ================= Root（极简兜底） ================= -->

    <root level="INFO">
        <appender-ref ref="CONSOLE"/>
        <appender-ref ref="APP_ERROR_FILE"/>
    </root>

    <!-- ================= 应用级日志 ================= -->

    <logger name="com.csxuhuan.gelatoni"
            level="DEBUG"
            additivity="false">
        <appender-ref ref="APP_FILE"/>
        <appender-ref ref="APP_ERROR_FILE"/>
    </logger>

    <!-- ================= Controller Digest Logger ================= -->

    <logger name="com.csxuhuan.gelatoni.aspect.controller"
            level="INFO"
            additivity="false">
        <appender-ref ref="CONTROLLER_DIGEST"/>
    </logger>

    <!-- ================= Redis Digest Logger ================= -->

    <logger name="com.csxuhuan.gelatoni.aspect.redis"
            level="INFO"
            additivity="false">
        <appender-ref ref="REDIS_DIGEST"/>
    </logger>

    <!-- ================= Mapper Digest Logger ================= -->

    <logger name="com.csxuhuan.gelatoni.aspect.mapper"
            level="INFO"
            additivity="false">
        <appender-ref ref="MAPPER_DIGEST"/>
    </logger>

</configuration>
